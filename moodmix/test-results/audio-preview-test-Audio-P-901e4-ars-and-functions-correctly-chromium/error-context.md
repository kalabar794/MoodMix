# Test info

- Name: Audio Preview Functionality >> Preview button appears and functions correctly
- Location: /Users/jonathonc/Auto1111/claude/MoodMix/moodmix/tests/audio-preview-test.spec.ts:10:7

# Error details

```
Error: locator.click: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('button[title*="preview"], button:has(div[class*="border-l"])').first()

    at /Users/jonathonc/Auto1111/claude/MoodMix/moodmix/tests/audio-preview-test.spec.ts:68:34
```

# Page snapshot

```yaml
- main:
  - img
  - heading "MoodMix" [level=1]
  - text: MoodMix
  - paragraph: Current Mood
  - paragraph: energetic
  - button "Change Mood"
  - button "Auto theme"
  - button "Show keyboard shortcuts"
  - heading "Keyboard Shortcuts" [level=2]
  - button
  - heading "Mood Selection" [level=3]
  - text: Select mood 1-9 1 2 3 ... 9 Select mood 10 (Triumphant) 0 Select mood 11 (Vulnerable) - Select mood 12 (Adventurous) =
  - heading "Navigation" [level=3]
  - text: Navigate mood cards ↑ ↓ ← → Select focused mood Enter Space Reset mood / Go back Esc
  - heading "Interface" [level=3]
  - text: Toggle theme (Dark/Light/Auto) T Show/hide keyboard shortcuts ?
  - paragraph: Press ? anytime to toggle this help
  - text: Current Mood energetic Intensity 75% Tracks Found 20
  - heading "Your Perfect Soundtrack" [level=2]
  - paragraph: High-octane tracks to fuel your dynamic spirit
  - text: 20 tracks curated for you 1
  - 'img "Time Out: New Year’s Eve Party, Background Celebration Songs 2020, Soft Jazz Vintage Mood"'
  - heading "Funny Dance" [level=3]
  - paragraph: Dale Burbeck
  - paragraph: "Time Out: New Year’s Eve Party, Background Celebration Songs 2020, Soft Jazz Vintage Mood"
  - text: 3:44
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/4rP3zawo5v2JiLjXiVqA9V
    - img
  - text: "2"
  - 'img "Jazz Music for Kids Day Celebration: Fun Play with Family (Spend Positive Time with Your Child)"'
  - heading "Party for Kids (Dance and Fun)" [level=3]
  - paragraph: Smooth Jazz Family Collective
  - paragraph: "Jazz Music for Kids Day Celebration: Fun Play with Family (Spend Positive Time with Your Child)"
  - text: 3:22
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/4KkYz0PEAA2yy77E5AVX16
    - img
  - text: "3"
  - img "LGBT Disco! Pride Month Celebration With Funky Dance Music"
  - heading "Party All Night" [level=3]
  - paragraph: Gay Bar Club, Just Dancing, Summertime Jazz
  - paragraph: LGBT Disco! Pride Month Celebration With Funky Dance Music
  - text: 3:47
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/3FfKfbfcDMEopvaA5tP1EL
    - img
  - text: "4"
  - 'img "Midnight Snowfall Celebration: Music for Welcoming the New Year"'
  - 'heading "Santa’s Dance Party: Fun Christmas Tunes to Get Everyone Moving" [level=3]'
  - paragraph: Drelliot
  - paragraph: "Midnight Snowfall Celebration: Music for Welcoming the New Year"
  - text: 3:57
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/5nOj9FTz6rVPNspzmthUUH
    - img
  - text: "5"
  - img "Retro Funky Edm Chill Dance Party Music"
  - heading "Centaur Celebration (Funky Chill Dance Beats)" [level=3]
  - paragraph: EDM Machine
  - paragraph: Retro Funky Edm Chill Dance Party Music
  - text: 3:48
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/72EAccSyUhBFJCNMAyfaOs
    - img
  - text: "6"
  - 'img "Wigwam Kids Party: Music Accompaniment for Fun and Games, Birthday Celebration (Children Between 5 to 8 years old), Vol. 1"'
  - heading "Little Shamanic Dance" [level=3]
  - paragraph: Child Care Specialists
  - paragraph: "Wigwam Kids Party: Music Accompaniment for Fun and Games, Birthday Celebration (Children Between 5 to 8 years old), Vol. 1"
  - text: 3:35
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/4HTxGsDQa9cQkD0FYYlev1
    - img
  - text: "7"
  - img "Popular (Music from the HBO Original Series)"
  - heading "Popular (with Playboi Carti & Madonna) - From The Idol Vol. 1 (Music from the HBO Original Series)" [level=3]
  - paragraph: The Weeknd, Playboi Carti, Madonna
  - paragraph: Popular (Music from the HBO Original Series)
  - text: 3:35
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/6WzRpISELf3YglGAh7TXcG
    - img
  - text: "8"
  - img "Dope Don't Sell Itself"
  - heading "Pop Music (feat. Moneybagg Yo & Beatking)" [level=3]
  - paragraph: 2 Chainz, Moneybagg Yo, BeatKing
  - paragraph: Dope Don't Sell Itself
  - text: 2:05
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/6vhdaXwxDmNYM8d4I383XJ
    - img
  - text: "9"
  - img "Pop Music"
  - heading "Pop Music (feat. Moneybagg Yo & Beatking)" [level=3]
  - paragraph: 2 Chainz, Moneybagg Yo, BeatKing
  - paragraph: Pop Music
  - text: 2:05
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/7562OP1Zx84xqrO5ECYour
    - img
  - text: "10"
  - img "POP MUSIC"
  - heading "SIREN" [level=3]
  - paragraph: Lilyisthatyou
  - paragraph: POP MUSIC
  - text: 2:16
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/1baqAtYnkpNzHAYwqibv0x
    - img
  - text: "11"
  - img "POP MUSIC"
  - heading "RELAX AFTER WORK WITH A DRINK" [level=3]
  - paragraph: Lilyisthatyou
  - paragraph: POP MUSIC
  - text: 1:57
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/1zoJ8Ixu6w7uWdEFToXr6c
    - img
  - text: "12"
  - img "Haha"
  - heading "Pop Music" [level=3]
  - paragraph: Lilac Boy
  - paragraph: Haha
  - text: 2:27
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/64mWHo1y0K4LL2LJJvVPSI
    - img
  - text: "13"
  - img "POP MUSIC"
  - heading "DANCE" [level=3]
  - paragraph: Lilyisthatyou
  - paragraph: POP MUSIC
  - text: 3:14
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/06B93ufTCpb6VWEiqgcVne
    - img
  - text: "14"
  - img "You're Just Like Pop Music"
  - heading "You're Just Like Pop Music" [level=3]
  - paragraph: YonKaGor
  - paragraph: You're Just Like Pop Music
  - text: 3:57
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/0UYnMDFZuXUpsiWGMq1EVk
    - img
  - text: "15"
  - img "POP MUSIC"
  - heading "GRINDING MY TEETH" [level=3]
  - paragraph: Lilyisthatyou
  - paragraph: POP MUSIC
  - text: 2:17
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/6amkSgnq8S1p7yruuPuADi
    - img
  - text: "16"
  - img "No Lyrics SFW Pop Instrumentals"
  - heading "Pop Music 2024" [level=3]
  - paragraph: Clean Pop Music, Instrumental Pop Music, Pop Songs 2023
  - paragraph: No Lyrics SFW Pop Instrumentals
  - text: 2:05
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/42GbsW1QgJu1AA68SKSCOA
    - img
  - text: "17"
  - img "POP MUSIC"
  - heading "SUPERSTAR" [level=3]
  - paragraph: Lilyisthatyou
  - paragraph: POP MUSIC
  - text: 2:52
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/5kfQF2FdBSlUrgik8cLYGR
    - img
  - text: "18"
  - img "Popular (Music from the HBO Original Series)"
  - heading "Popular (with Playboi Carti & Madonna) - From The Idol Vol. 1 (Music from the HBO Original Series)" [level=3]
  - paragraph: The Weeknd, Playboi Carti, Madonna
  - paragraph: Popular (Music from the HBO Original Series)
  - text: 3:35
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/67gUqq3wVAztSquOpNZ4Xs
    - img
  - text: "19"
  - img "Baby Sleep Music"
  - heading "Pop Goes the Weasel" [level=3]
  - paragraph: Lullaby Time
  - paragraph: Baby Sleep Music
  - text: 2:06
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/3kJtQ79tvaCFkCiXtpPfBw
    - img
  - text: "20"
  - img "pop music just hits"
  - heading "Lose Control" [level=3]
  - paragraph: Teddy Swims
  - paragraph: pop music just hits
  - text: 3:30
  - button "—" [disabled]
  - button "Listen on Spotify":
    - img
  - link:
    - /url: https://open.spotify.com/track/00ahQEcgGCvXEujKtLUcZJ
    - img
  - img
  - text: Powered by Spotify
  - paragraph: Powered by Spotify • Made for music lovers
- alert
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test'
   2 |
   3 | test.describe('Audio Preview Functionality', () => {
   4 |
   5 |   test.beforeEach(async ({ page }) => {
   6 |     await page.goto('https://mood-mix-theta.vercel.app')
   7 |     await page.waitForLoadState('networkidle')
   8 |   })
   9 |
   10 |   test('Preview button appears and functions correctly', async ({ page }) => {
   11 |     console.log('🎵 Testing audio preview functionality...')
   12 |     
   13 |     // Select a mood to get music results
   14 |     const moodButton = page.locator('button:has-text("Energetic")').first()
   15 |     await moodButton.click()
   16 |     await page.waitForTimeout(5000) // Wait for music results
   17 |     
   18 |     // Check if music results loaded
   19 |     const resultsVisible = await page.locator('text="Your Perfect Soundtrack"').isVisible()
   20 |     if (!resultsVisible) {
   21 |       console.log('   ⚠️ No music results loaded - skipping preview test')
   22 |       return
   23 |     }
   24 |     
   25 |     console.log('   ✅ Music results loaded')
   26 |     
   27 |     // Find preview buttons
   28 |     const previewButtons = page.locator('button[title*="preview"], button:has(div[class*="border-l"])')
   29 |     const previewButtonCount = await previewButtons.count()
   30 |     console.log(`   📊 Preview buttons found: ${previewButtonCount}`)
   31 |     
   32 |     if (previewButtonCount === 0) {
   33 |       console.log('   ⚠️ No preview buttons found')
   34 |       return
   35 |     }
   36 |     
   37 |     // Test first available preview button
   38 |     const firstPreviewButton = previewButtons.first()
   39 |     const isEnabled = await firstPreviewButton.isEnabled()
   40 |     console.log(`   📊 First preview button enabled: ${isEnabled}`)
   41 |     
   42 |     if (isEnabled) {
   43 |       // Click to play preview
   44 |       await firstPreviewButton.click()
   45 |       await page.waitForTimeout(2000)
   46 |       
   47 |       // Check for playing state indicators
   48 |       const playingIndicators = [
   49 |         page.locator('[class*="ring-purple"]'), // Playing card highlight
   50 |         page.locator('div:has(div[class*="bg-white rounded-full"])'), // Pause button
   51 |         page.locator('[class*="fixed bottom"]'), // Global audio control
   52 |         page.locator('text="🔊"') // Volume control
   53 |       ]
   54 |       
   55 |       let foundPlayingIndicator = false
   56 |       for (const indicator of playingIndicators) {
   57 |         if (await indicator.count() > 0) {
   58 |           foundPlayingIndicator = true
   59 |           console.log('   ✅ Playing state indicator found')
   60 |           break
   61 |         }
   62 |       }
   63 |       
   64 |       if (foundPlayingIndicator) {
   65 |         console.log('   ✅ Audio preview appears to be playing')
   66 |         
   67 |         // Test pause functionality
>  68 |         await firstPreviewButton.click()
      |                                  ^ Error: locator.click: Test timeout of 30000ms exceeded.
   69 |         await page.waitForTimeout(1000)
   70 |         
   71 |         // Check if playing indicators disappeared
   72 |         const stillPlaying = await page.locator('[class*="ring-purple"]').count() > 0
   73 |         console.log(`   ✅ Pause functionality: ${stillPlaying ? 'May still be playing' : 'Appears to have paused'}`)
   74 |       } else {
   75 |         console.log('   ⚠️ No clear playing state indicators found')
   76 |       }
   77 |     } else {
   78 |       console.log('   ⚠️ Preview button is disabled (no preview available)')
   79 |     }
   80 |   })
   81 |
   82 |   test('Global audio control panel appears when playing', async ({ page }) => {
   83 |     console.log('🎛️ Testing global audio control panel...')
   84 |     
   85 |     // Select a mood and wait for results
   86 |     const moodButton = page.locator('button:has-text("Passionate")').first()
   87 |     await moodButton.click()
   88 |     await page.waitForTimeout(5000)
   89 |     
   90 |     // Check if results loaded
   91 |     const hasResults = await page.locator('text="Your Perfect Soundtrack"').isVisible()
   92 |     if (!hasResults) {
   93 |       console.log('   ⚠️ No music results - skipping global control test')
   94 |       return
   95 |     }
   96 |     
   97 |     // Find and click a preview button
   98 |     const previewButtons = page.locator('button[title*="preview"], button:has(div[class*="border-l"])')
   99 |     const enabledPreviewButton = previewButtons.first()
  100 |     
  101 |     const isButtonEnabled = await enabledPreviewButton.isEnabled()
  102 |     if (isButtonEnabled) {
  103 |       await enabledPreviewButton.click()
  104 |       await page.waitForTimeout(2000)
  105 |       
  106 |       // Look for global audio control panel
  107 |       const globalControls = [
  108 |         page.locator('.fixed.bottom-6'), // Fixed bottom position
  109 |         page.locator('text="🔊"'), // Volume icon
  110 |         page.locator('[type="range"]'), // Volume slider
  111 |         page.locator('button:has(span:text("×"))') // Close button
  112 |       ]
  113 |       
  114 |       let foundGlobalControl = false
  115 |       for (const control of globalControls) {
  116 |         if (await control.count() > 0) {
  117 |           foundGlobalControl = true
  118 |           console.log('   ✅ Global audio control found')
  119 |           break
  120 |         }
  121 |       }
  122 |       
  123 |       if (foundGlobalControl) {
  124 |         console.log('   ✅ Global audio control panel working')
  125 |         
  126 |         // Test volume control if present
  127 |         const volumeSlider = page.locator('[type="range"]')
  128 |         if (await volumeSlider.count() > 0) {
  129 |           console.log('   ✅ Volume control available')
  130 |         }
  131 |         
  132 |         // Test close button if present
  133 |         const closeButton = page.locator('button:has(span:text("×"))')
  134 |         if (await closeButton.count() > 0) {
  135 |           await closeButton.click()
  136 |           await page.waitForTimeout(1000)
  137 |           
  138 |           const controlStillVisible = await page.locator('.fixed.bottom-6').count() > 0
  139 |           console.log(`   ✅ Close button: ${controlStillVisible ? 'Still visible' : 'Hidden successfully'}`)
  140 |         }
  141 |       } else {
  142 |         console.log('   ⚠️ Global audio control panel not found')
  143 |       }
  144 |     } else {
  145 |       console.log('   ⚠️ No enabled preview buttons found')
  146 |     }
  147 |   })
  148 |
  149 |   test('Progress bar and time display functionality', async ({ page }) => {
  150 |     console.log('⏱️ Testing progress bar and time display...')
  151 |     
  152 |     // Get music results
  153 |     const moodButton = page.locator('button:has-text("Serene")').first()
  154 |     await moodButton.click()
  155 |     await page.waitForTimeout(5000)
  156 |     
  157 |     const hasResults = await page.locator('text="Your Perfect Soundtrack"').isVisible()
  158 |     if (!hasResults) {
  159 |       console.log('   ⚠️ No music results - skipping progress test')
  160 |       return
  161 |     }
  162 |     
  163 |     // Start preview
  164 |     const previewButton = page.locator('button[title*="preview"], button:has(div[class*="border-l"])').first()
  165 |     const isEnabled = await previewButton.isEnabled()
  166 |     
  167 |     if (isEnabled) {
  168 |       await previewButton.click()
```